# Goプログラミング実践入門 標準ライブラリでゼロからWebアプリを作る impress
今日はがっつりGoの勉強をしたので、その学びをアウトプットしていこうと思います。  
ちなみにGoはちょっと触ったことがありますが、これから文法を学びたいくらい浅い知識がない状態です。  
あとは僕が普段PHPを使用しているので、PHPとの比較もしつつ書いていこうかなと思っています。

## Go言語とは
Googleがリリースした言語で、主にWebアプリケーションのバックエンド側を作るのに使用されることが多い。  
Cのような手続き型のプログラミング言語に近く、同時に関数型言語の特徴も併せ持っている。  
並行実行を標準でサポートし、モダンなパッケージ作成システムがあり、ガベージコレクションも搭載し、強力なライブラリが組み込まれている。  

## Goのいいところ
- 直感的で理解しやすいコード
- 実用に耐えうるアプリケーションが標準ライブラリを使うだけで作れる
- 簡単で素早いコンパイルで、そのままデプロイ可能なバイナリファイルができる

## Goでアプリケーションを作るメリット
昨今のWeb開発では、ほとんどの現場でWebフレームワークを使用して開発が行われています。  
それによって、効率的な開発ができているわけですが、詳細が隠されてしまっていることにより、WWWがなんたるやを知らずにWeb開発を行っている人もいます。

そんな中でもGoは標準ライブラリのみを組み合わせてWebアプリケーションが作れるため、Webの仕組みを学ぶのに最適なわけである。

ということで、この書籍はGoの基本を学んでいる前提で進んでいくのでご注意ください。  
正直入門からやりたかったので、この時点で書籍選びをミスっているのですが、ポテンシャルでどこまで行けるのか実験したいと思います。  

## 大規模サービスでGo言語が普及している理由
Goは特に大規模なサービスで普及していますが、まず前提として大規模な開発を行っている現場では以下のような性質の言語が求められています。  
1. スケーラビリティ
2. モジュール性
3. 保守性
4. 高い実行効率

### スケーラビリティ
まずスケーラビリティとは、処理能力を高めて、より多くのリクエストをさばけるようにする能力のことです。  
単一マシンのスペックを上げて処理能力を上げる垂直スケーラビリティと、サーバの台数を増やして処理能力を上げる水平スケーラビリティがあります。  
そして、Goは並行プログラミングをサポートしているため、垂直スケーラビリティとの相性が抜群です。  
また、単体で動くバイナリを生成するため、他のサーバにも簡単にデプロイでき、水平スケーラビリティもいい感じです。  

### モジュール性
モジュール性というのは、機能のまとまりを交換可能な状態にしておくことをいいます。  
ComposerやNPMでダウンロードしてくる一つ一つのライブラリもモジュールですし、自作した機能で独立して交換可能な部分もモジュールと呼びます。  
モジュール性が高いと、その機能だけを取り替えるということができるため、ソフトウェアの変更や追加、削除がしやすく保守性が高くなります。  
Goは関数型の特徴を備えていますが、関数型の言語というのは各関数の交換がしやすいという特徴があります。  
そのため、関数型の特徴をうまく取り込むことでモジュール生の高いコードを書くことができます。  

### 保守性
ここでの保守性はコードの保守性のことを指します。  
Goはソフトウェア高額における良いプラクティスを推進するように設計されています。  
それはコードのシンプルさや可読性だけでなく、標準ライブラリだけで構文のフォーマッタ、コードからのドキュメント生成、テスト実行などができるのです。  

### 高い実効性
要はパフォーマンスのことですね。  
Goはネイティブコードをコンパイルして生成するために、一般的にPHPやPython、Rubyなどのインタプリタで動く言語よりも高速に動作します。  
また、並行実行がサポートされているため、複数のリクエストを効率よく処理することができます。  

## そもそもWebアプリケーションとは
GoでWebアプリケーションを作る前に、その言葉の意味を定義してみましょう。  
一言でWebアプリケーションと言っても人によってイメージするものは違うでしょう。  
特にWebサイト、Webアプリケーション、Webサービスなど、似たようで微妙にニュアンスの違う言葉はたくさんあります。  
ちなみに本書ではWebを通じて、ユーザーとインタラクションにやり取りを行って、ユーザーの活動を支援するサービスをWebアプリケーションと定義しています。  
具体的に言い換えると、
- リクエストを飛ばしたクライアントにHTMLを返し、クライアントはそれをユーザーに提示する
- データがHTTPを使ってやりとりされる
の2つの条件を満たすということになります。  

そのため、他のサービスに向けて公開しているAPIなどはWebアプリケーションではなく、Webサービスに分類するというような定義を行っていきます。  
なんだかこの辺を厳密に考えたことがなかったので、新鮮ですね。ちなみに僕はしっくり来ていないですw

## Webアプリケーション誕生の歴史
まず元はHTTPを使って静的なHTMLを返す仕組みになっていました。  
しかしニーズが拡大し、内容を動的に生成するともっと良いよねってことで誕生したのがCGIです。  
CGIはWebサーバ的な動きをするプログラムですが、仕組み上大規模なサービスに対応できなくなるような欠点がありました。  
そのため同時期に出現した、SSI(サーバーサイドインクルード)という、原始的なテンプレートエンジンみたいな仕組みが進化を遂げて、現在でも使われているWebサーバプログラムやテンプレートエンジンが出来上がりました。  
そしてこれがWebアプリケーション誕生の背景になります。  

## Webアプリケーションを知るために知っておいて欲しい、HTTPの重要概念
この辺を解説すると長くなるので、キーワードだけピックアップしておきます。  
理解が怪しいところがあるなら調べてみると良いかもしれません。  

- リクエスト
- リクエストの構造
- 各種リクエストメソッド
- 冪等性
- 安全性
- XHR
- レスポンス
- レスポンスの構造
- ステータスコード
- URI

## Webアプリケーションは2つの要素からできている
Webアプリケーションは言ってしまえば2つの要素でできています。  
一つは、HTTPリクエストを受け取り、レスポンスを生成する「ハンドラ」。  
もう一つは、見た目を構成する「テンプレートエンジン」です。  
よく開発でMVCパターンが使用されますが、MとCがハンドラで、Vがテンプレートエンジンに当たります。  
よくあるパターンだとサービスレイヤのクラスを作成することがありますが、それもハンドラになります。  

こう見ると、ハンドラの役割の重さがすごいですね。  

## Goの文法
さて、早速コードを見ていきましょう。
基礎構文とかその辺りは公式サイトを見てみてください。  

### パッケージ宣言

```go
package main
```
まずGoでは`package`キーワードに続いて、パッケージ名を書きます。  
PHPをやってきた僕からすると、このパッケージとう概念が斬新すぎるのですが、きっとモジュールを作りやすいんだと思う。  

また、PHP等ではWebサーバソフトウェアで、どのディレクトリを公開するのかを設定して、その設定に合うようにコードを配置する必要がありましたが、Goはそのサーバソフトウェア的な部分もパッケージに入っており、一緒にビルドすることでスタンドアローンのWebアプリケーションが完成するそうです。  

### パッケージのインポート

```go
import (
    "パッケージ名"
    "パッケージ名"
)
```
また、GoはPHPと違って、組み込みの機能を使うにしてもインポートする必要があります。  
ビルドには使うものだけ混ぜ込みたいからなんでしょうね、きっと。  
こういうパッケージをインポートして使う系の言語を使用している人はどうやってパッケージを覚えていってるんだろう…。ちょっと気になります。  

### 関数定義

```go
func 関数名 (引数 型, ...) {
    処理
}
```
関数定義は上記の通りです。  
PHPとは引数名と型を書く位置が逆なので混乱しますね。全言語統一せよ。  

ちなみにバイナリ実行ファイルにコンパイルするプログラムには、必ず`main`という名前の関数を定義する必要があります。  
そしてプログラムを実行した際は、このmain関数から実行が開始されます。エントリーポイント的な感じですね。  

以上が、本書で書かれているGoの文法的な部分です。  
少ない！ちょっとこの量の知識で大丈夫か不安になってきましたが、次の章からはアプリケーションを作っていくそうです...

## アプリケーションの実装に際して戸惑ったポイント
アプリケーションの実装は本に書いているので、ここではGoほぼ未経験者が本書を読みすすめるにあたって戸惑ったポイントを羅列していこうと思います。  

### 関数の呼び出しみたいなところで{}を使っているのは何？
```go
// 関数の場合
hoge(val)

// 構造体の場合
fuga {
    foo: "bar" 
}
```
ちなみに構造体の方は初期化という言うらしい。  
イメージとしては、jsでオブジェクトを作る時に、プロパティを設定してみました的なノリに見える。  

### ファイルを分けたときのインクルードはどうやるのか？
プログラムを触っていると、ファイルを分けて、分けたファイルを別のファイルから利用したいケースがある  
ちなみに、今回はmain.goから別のファイルの関数を呼びたかったのですが、なんと同じディレクトリに置いておけば勝手にインクルードしてくれるらしい。  
別のパッケージに入れてインクルードすることもできるらしいので、ファイルが少ないシンプルなものであれば、同じディレクトリに置いちゃって大規模なアプリケーションなら、パッケージでやるみたいな使い分けができそう。  

### ちょくちょく出てくる&と*
これはCとかC++とか触ったことないと初見くらいの勢いだと思うのですが、どちらもポインタ関連の記号です。  
ポインタは僕も厳密なところはよくわかっていませんが、PHPでいう参照渡し的なやつだと思います。  

```go
func main() {
    var var1 int = 1
    var var2 *int = &var1
    fmt.Println(var1) // 1が出力される
    fmt.Println(var2) //=> 0x10432030みたいな感じで変数のメモリアドレスが出力される
}
```
ちなみにこの辺りは、ゼロからの自作OS入門をやるとふわっとわかるようになると思います。  
ただしふわっとしかわからない。  

### 変数の分割代入？ができるっぽい
```go
threads, err := data.Threads()
```
上記みたいな感じで、返り値が2個あるのかデストラクチャリングをしているのかわかりませんが、分割代入みたいなことができるようです。  
errがあるときはerrに何かが入るので、errがnilかどうかでエラーチェックを行うというのをよくやります。  

### パッケージのインポート勝手にやってくれるの便利
VSCodeを使うと、コードの中で出てきた標準ライブラリのインポートを勝手にやってくれる。便利。  


### ()が複数並んでいる関数は一体何なのか？
```go
func session(w http.ResponseWriter, r *http.Request)(sess data.Session, err error) {
	
}
```
２つ目の`()`の中は返り値らしい。  
この書き方をすることで、一気に複数の返り値を返すことができます。  
例えば今回だったら、sessとerrに値を突っ込んでおけば最後returnで処理が終わった時にそれを返してくれるんだとか…。  
ちょっとまだコード完成していないせいで動かないので、確かめられてないですけど。  

### 制御構文の中にあるセミコロンは何なのか？
```go
if ok, _ := sess.Check(); !ok {

}
```
これは、簡易文というものを使った方法らしい。  
例えば今回の場合Checkの返り値は複数あるため、単純に条件式に突っ込むことができません。  
ただそのためだけに変数を宣言するのも気持ちが悪いので、ifの中に、;で区切って、`簡易文;条件式`という書き方をすることで、if文が便利に書けるというものです。  
簡易文で作成した変数はifのブロックスコープでのみ使えるそうなので、メモリ効率も良さそうです。

### 結局構造体とクラスの違いは何なのか？
使い方が違うだけで、やれることはだいぶ近い印象
